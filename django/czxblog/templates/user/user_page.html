<!DOCTYPE html>
<!-- Template by Quackit.com -->
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>夕象^登录</title>

    <!-- Bootstrap 4 CSS. This is for the alpha 3 release of Bootstrap 4. This should be updated when Bootstrap 4 is officially released. -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/css/bootstrap.min.css" integrity="sha384-MIwDKRSSImVFAZCVLtU0LMDdON6KVCrZHyVQQj6e8wIEJkW4tvwqXrbMIya1vriY" crossorigin="anonymous">
      
    <!-- Custom CSS: You can use this stylesheet to override any Bootstrap styles and/or apply your own styles -->
    <link href="/static/css/custom.css" rel="stylesheet">
    <!--网页图标-->
    <link rel="shortcut icon" href="/static/images/Panda_Kungfu.ico">
    <!-- For icons -->
    <link href="/static/css/font-awesome-4.6.3/css/font-awesome.min.css" rel="stylesheet">
	<!--全局样式-->
	<link rel="stylesheet" type="text/css" href="/static/global/all-2.0.1.css">
	<!--使用bootstrap框架-->
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.min.css">
    <script src="/static/js/bootstrap/jquery-1.11.3.min.js"></script>
    <script src="/static/js/bootstrap/bootstrap.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    <!-- 顶部状态栏 -->
    <div id="topNav" class="navbar navbar-full navbar-static-top navbar-dark bg-inverse m-b-1">
        <div class="navbar-header">
			<button class="navbar-toggle navbar-white" type="button" data-toggle="collapse" data-target="#example-navbar-collapse">
				<span class="sr-only">切换导航</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">陈志祥的博客</a>
		</div>
        <div class="collapse navbar-collapse" id="example-navbar-collapse">
            <ul class="nav navbar-nav">
                <li class>
                    <a href="/"><i class="fa fa-home"></i> 首页</a>
                </li>
                <li class>
					<a href="#"><i class="fa"></i>About</a>
                </li>
                <li class>
					<a href="#"><i class="fa"></i>Products</a>
                </li>
                <li class>
                    <a href="#" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<i class="fa"></i>Services
                    </a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                        <a class="dropdown-item" href="#">Engage</a>
                        <a class="dropdown-item" href="#">Pontificate</a>
                        <a class="dropdown-item" href="#">Synergize</a>
                    </div>
                </li>
            </ul>

            <!-- Search -->
            <form action="/search/" class="navbar-form navbar-right">
                <input class="form-control" type="text" placeholder="搜索你感兴趣的内容" autocomplete="off">
                <button type="submit">
					<i class="fa fa-search-plus"></i>
				</button>
            </form>

			<ul id="user_part" class="nav navbar-nav navbar-right">
                <li>
					<a href="/user/user_page">登录</a>
				</li>
			</ul>
        </div>
    </div>

	<div class="container">
		<div class="head_text">
			<h1 class="text-info">欢迎登录</h1>
			<small>让我们一起分享你的知识、经验和见解</small>
		</div>
		<form id="user_form" class="main_form" method='post'>
			<input id="reback_url" type="hidden" value="{{reback_url}}">
			<div id="user_control">
				<div class="control-group">
					<label class="control-label" for="user_name">邮箱：</label>
					<input type="text" id="user_name" class="input-xlarge" name="user_name" placeholder="请输入邮箱" autocomplete="off">
				</div>
				<div class="control-group">
					<label class="control-label" for="user_pwd">密码：</label>
					<input type="password" id="user_pwd" class="input-xlarge" name="user_pwd" placeholder="请输入密码" autocomplete="off">
				</div>
			</div>

            <div class="account_list">
				<span class="other_account">第三方账号登录：</span>
				<a href="/oauth/qq_login?state={{reback_url}}" title="QQ登录">
					<img src="/static/images/logo/logo_qq.png" alt="QQ登录">
				</a>
				<a href="/oauth/sina_login?state={{reback_url}}" title="微博登录">
					<img src="/static/images/logo/logo_sina.png" alt="微博登录">
				</a>
				<a href="/oauth/github_login?state={{reback_url}}" title="Github登录">
					<img src="/static/images/logo/logo_github.png" alt="Github登录">
				</a>
			</div>

			<p id="tip_text" style="color:red;"></p>
			<div class="form_buttons">
				<p>我是老用户：</p>
				<input type="submit" class="btn btn-primary" value="登录"/>
				<a class="btn btn-default" href="{% url 'password_lost' %}">忘记密码</a>
			</div>
			<div class="form_buttons" style="margin-left:1.5em;">
				<p>我是新用户：</p>
				<input id="user_register" type="button" class="btn btn-primary" value="注册"/>
			</div>
		</form>
	</div>

    <footer>
		<div class="footer-blurb">
			<div class="container fa-align-center">
				<div class="row">
					<div class="col-sm-4 footer-blurb-item">
						<h3><i class="fa fa-text-height" aria-hidden="true"></i> 关于本站</h3>
						<p>1、基于Django+Bootstrap开发</p>
						<p>2、主要发表本人的技术原创博客</p>
						<p>3、本站于 2017-7-01 开始建站</p>
					</div>
					<div class="col-sm-4 footer-blurb-item">
						<h3><i class="fa fa-wrench" aria-hidden="true"></i> 建议反馈</h3>
						<p>1、可在相应的博文底下评论</p>
						<p>2、发邮件到1946709553@qq.com</p>
					</div>
					<div class="col-sm-4 footer-blurb-item">
						<h3><i class="fa fa-paperclip" aria-hidden="true"></i> 友情链接</h3>
						<p>1、获得较好的级</p>
						<p>2、即可打开发几咖啡</p>
					</div>
				</div>
			</div>
        </div>
        <div class="small-print">
        	<div class="container">
        		<p><a href="#">Terms &amp; Conditions</a> | <a href="#">Privacy Policy</a> | <a href="#">Contact</a></p>
        		<p>Copyright &copy; <a href="/" ><font color="black">chenzhixiang.com</font></a> 2017 </p>
        	</div>
        </div>
	</footer>

	<script src="/static/js/holder.min.js"></script>
    <script type="text/javascript">
        $(function(){
            //滚动事件
            $(window).scroll(function(){
                var top=$(window).scrollTop();
                var navbar = $(".navbar-fixed-top");

                if(top==0){
                    $(".navbar-fixed-top").removeClass("navbar-down");
                }else{
                    $(".navbar-fixed-top").addClass("navbar-down");
                }

                if(top>350){
                    $("#scrolltop").fadeIn();
                }else{
                    $("#scrolltop").fadeOut();
                }
            });

            //点击返回头部效果
            $("#scrolltop").click(function(){
                $("html,body").animate({scrollTop:0});
            });

            //窗体改变大小事件
            $(window).resize(function(){
                //正文高度
                var body_height = $(document.body).outerHeight(true);

                //底部元素高度
                var bottom_height = $("#footer").outerHeight(true);

                //浏览器页面高度
                var window_height = $(window).height();

                //判断并调整底部元素的样式
                if($("#footer").hasClass('page-bottom-abs')){
                    if(body_height + bottom_height >= window_height){
                        $("#footer").removeClass('page-bottom-abs');
                    }
                }else{
                    if(body_height < window_height){
                        $("#footer").addClass('page-bottom-abs');
                    }
                }
            });

            //页面加载时，模拟触发一下resize事件
            $(window).trigger('resize');

//            //检查登录状态和获取公告
//            var user_menu = '<li><a href="/user/login_page">登录</a></li>';
//            $.ajax({
//                type:"GET",
//                url:"/user/check_is_login",
//                cache:false,
//                dataType:'json',
//                success:function(data){
//                    var notice;
//                    if(data['code']=='0'){
//                        user_menu = data['user_menu'];
//                        notice = data['notice'];
//                    }else{
//
//                        notice='暂无公告';
//                    };
//
//                    //$("#user_part").html(user_menu);
//                    $('.myRewards-text').html(notice);
//                    tctipConfig.list.notice.text=notice;
//                },
//                error:function(XMLHttpRequest, textStatus, errorThrown){
//                    $("#user_part").html(user_menu);
//                }
//            });
        });
    </script>
	<!--登录注册页面样式-->
    <style type="text/css">
        .head_text{
            text-align: center;
            margin: 2em auto;
        }
        .main_form{
            margin: 0 auto;
            width: 330px;
            border: 2px #aaa dashed;
            padding: 1.5em 0em 0em 1.5em;
        }
        .main_form a{
            text-decoration: none;
        }
        .other_account{
            font-weight: bolder;
        }
        .account_list{
            margin-top: 0.5em;
        }
        .form_buttons{
            margin-top: 2em;
            float: left;
        }
    </style>
    <!--前端登录注册ajax请求-->
    <script type="text/javascript">
        $(function(){
            //登录
            $('#user_form').submit(function(){
                //验证
                var tip=$('#tip_text');
                tip.text('');

                if($('#user_name').val()==''){
                    tip.text('请输入邮箱');
                    return false;
                };
                if($('#user_pwd').val()==''){
                    tip.text('请输入密码');
                    return false;
                };

                //登录
                $.ajax({
                    type: "POST",
                    data: $('#user_form').serialize(), //$.param(data),
                    url: "{% url 'user_login' %}",
                    cache: false,
                    dataType: "json",
                    success: function(json, textStatus){
                        var is_success = json['success'];
                        if(is_success){
                            tip.text('登录成功，页面处理中...');

                            //跳转回原来的页面
                            var reback_url = $('#reback_url').val();
                            if(!reback_url){reback_url='/';}
                            window.location.href = reback_url;
                        }else{
                            tip.text('邮箱或者密码错误，请重试');
                        };
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        tip.text("登录出错，请重试 "+errorThrown);
                    }
                });
                return false;
            });

            //注册
            $('#user_register').click(function(){
                //验证
                var tip=$('#tip_text');
                tip.text('');

                var reg_name=$('#user_name').val();
                var reg_pwd=$('#user_pwd').val();

                if(reg_name==''){
                    tip.text('邮箱不能为空');
                    return false;
                };
                if(!reg_name.match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)){
                    tip.text('请输入正确的邮箱格式');
                    return false;
                }

                if(reg_pwd==''){
                    tip.text('密码不能为空');
                    return false    ;
                };
                if(reg_pwd.length<6){
                    tip.text('密码不能少于6位');
                }

                //注册
                tip.text('注册中，请稍后...');
                $.ajax({
                    type: "POST",
                    data:$('#user_form').serialize(), // $.param(data),
                    url: "{% url 'user_register' %}",
                    cache: false,
                    dataType: "json",
                    success: function(json, textStatus){
                        var is_success = json['success'];
                        if(is_success){
                            tip.text('注册成功，页面处理中...');
                            $('#user_control').text(json['message']);

                            window.setTimeout(function(){
                                var reback_url = $('#reback_url').val();
                                if(!reback_url){reback_url='/';}
                                window.location.href = reback_url;
                            },3000);
                        }else{
                            tip.text(json['message']);
                        };
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        tip.text("注册出错，请重试 "+errorThrown);
                    }
                });
                return false;
            });
        });
    </script>

</body>

</html>
